<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Airport Analytics Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        .dashboard-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            margin-bottom: 1rem;
        }
        .stat-card:hover {
            transform: translateY(-5px);
        }
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #667eea;
        }
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        .loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }
        .navbar-brand {
            font-weight: bold;
            font-size: 1.5rem;
        }
        .prediction-alert {
            background: linear-gradient(45deg, #ff6b6b, #ee5a6f);
            color: white;
            border: none;
            border-radius: 10px;
        }
    </style>
</head>
<body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-plane"></i> Airport Analytics Dashboard
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text">
                    <i class="fas fa-chart-line"></i> Analyse Prédictive du Trafic Aérien
                </span>
            </div>
        </div>
    </nav>

    <div class="dashboard-header">
        <div class="container text-center">
            <h1><i class="fas fa-chart-bar"></i> Tableau de Bord Analytique</h1>
            <p class="lead">Analyse des données de trafic aérien et prédictions intelligentes</p>
        </div>
    </div>

    <div class="container">
        <!-- Statistiques principales -->
        <div class="row" id="stats-row">
            <div class="col-md-3">
                <div class="stat-card text-center">
                    <i class="fas fa-plane-departure fa-2x text-primary mb-2"></i>
                    <div class="stat-number" id="total-flights">-</div>
                    <div class="text-muted">Total Vols</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card text-center">
                    <i class="fas fa-times-circle fa-2x text-danger mb-2"></i>
                    <div class="stat-number" id="cancelled-flights">-</div>
                    <div class="text-muted">Vols Annulés</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card text-center">
                    <i class="fas fa-clock fa-2x text-warning mb-2"></i>
                    <div class="stat-number" id="avg-delay">-</div>
                    <div class="text-muted">Retard Moyen (min)</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card text-center">
                    <i class="fas fa-map-marker-alt fa-2x text-success mb-2"></i>
                    <div class="stat-number" id="unique-airports">-</div>
                    <div class="text-muted">Aéroports</div>
                </div>
            </div>
        </div>

        <!-- Alerte prédictive -->
        <div class="row">
            <div class="col-12">
                <div class="alert prediction-alert" role="alert">
                    <h5><i class="fas fa-brain"></i> Insight Prédictif</h5>
                    <p class="mb-0">Basé sur l'analyse des données historiques, les mois d'hiver montrent une tendance à plus de retards. Recommandation : prévoir des ressources supplémentaires en décembre-février.</p>
                </div>
            </div>
        </div>

        <!-- Graphiques -->
        <div class="row">
            <div class="col-lg-6">
                <div class="chart-container">
                    <h5><i class="fas fa-chart-pie"></i> Distribution des Retards</h5>
                    <div id="delay-distribution" class="loading">
                        <i class="fas fa-spinner fa-spin"></i> Chargement...
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="chart-container">
                    <h5><i class="fas fa-chart-line"></i> Tendances Mensuelles</h5>
                    <div id="monthly-trends" class="loading">
                        <i class="fas fa-spinner fa-spin"></i> Chargement...
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-6">
                <div class="chart-container">
                    <h5><i class="fas fa-route"></i> Top Routes</h5>
                    <div id="top-routes" class="loading">
                        <i class="fas fa-spinner fa-spin"></i> Chargement...
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="chart-container">
                    <h5><i class="fas fa-building"></i> Performance Compagnies</h5>
                    <div id="airline-performance" class="loading">
                        <i class="fas fa-spinner fa-spin"></i> Chargement...
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-6">
                <div class="chart-container">
                    <h5><i class="fas fa-crystal-ball"></i> Prédiction des Retards</h5>
                    <div id="predict-delays" class="loading">
                        <i class="fas fa-spinner fa-spin"></i> Chargement...
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="chart-container">
                    <h5><i class="fas fa-cloud-rain"></i> Impact Saisonnier</h5>
                    <div id="weather-impact" class="loading">
                        <i class="fas fa-spinner fa-spin"></i> Chargement...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-dark text-white text-center py-4 mt-5">
        <div class="container">
            <p>&copy; 2025 Airport Analytics Dashboard - Analyse Prédictive du Trafic Aérien</p>
            <p><i class="fas fa-code"></i> Développé avec Flask, Plotly & Bootstrap</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Fonction pour charger les statistiques
        async function loadStats() {
            try {
                const response = await fetch('/api/stats');
                const data = await response.json();
                
                document.getElementById('total-flights').textContent = data.total_flights?.toLocaleString() || '-';
                document.getElementById('cancelled-flights').textContent = data.cancelled_flights?.toLocaleString() || '-';
                document.getElementById('avg-delay').textContent = data.avg_delay || '-';
                document.getElementById('unique-airports').textContent = data.unique_airports || '-';
            } catch (error) {
                console.error('Erreur lors du chargement des statistiques:', error);
            }
        }

        // Fonction pour charger un graphique
        async function loadChart(endpoint, elementId) {
            try {
                const response = await fetch(endpoint);
                const data = await response.text();
                const fig = JSON.parse(data);
                Plotly.newPlot(elementId, fig.data, fig.layout, {responsive: true});
            } catch (error) {
                console.error(`Erreur lors du chargement de ${endpoint}:`, error);
                document.getElementById(elementId).innerHTML = '<p class="text-danger">Erreur de chargement</p>';
            }
        }

        // Charger tous les graphiques
        async function loadAllCharts() {
            await loadStats();
            
            const charts = [
                { endpoint: '/api/delay_distribution', element: 'delay-distribution' },
                { endpoint: '/api/monthly_trends', element: 'monthly-trends' },
                { endpoint: '/api/top_routes', element: 'top-routes' },
                { endpoint: '/api/airline_performance', element: 'airline-performance' },
                { endpoint: '/api/predict_delays', element: 'predict-delays' },
                { endpoint: '/api/weather_impact', element: 'weather-impact' }
            ];

            // Charger les graphiques en parallèle
            await Promise.all(charts.map(chart => 
                loadChart(chart.endpoint, chart.element)
            ));
        }

        // Charger au démarrage
        document.addEventListener('DOMContentLoaded', loadAllCharts);

        // Recharger toutes les 5 minutes
        setInterval(loadAllCharts, 300000);
    </script>
</body>
</html>